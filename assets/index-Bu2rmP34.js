import{e as v,g as Y,r as P,u as M,f as g,w as O,h as w,x as _,y as q}from"./create-split-props-B1LGkfrB.js";import{a as k,q as N,f as I,i as X}from"./index-DtKw-7gC.js";import{e as S,f as H,w as K}from"./use-locale-context-CfI1cghP.js";function U(e){const t={each(r){var s;for(let i=0;i<((s=e.frames)==null?void 0:s.length);i+=1){const n=e.frames[i];n&&r(n)}},queueBeforeEvent(r,s){const i=new Set;return t.each(n=>{try{i.add(N(n.document,r,s))}catch{}}),()=>{try{i.forEach(n=>n())}catch{}}},addEventListener(r,s,i){return t.each(n=>{try{n.document.addEventListener(r,s,i)}catch{}}),()=>{try{t.removeEventListener(r,s,i)}catch{}}},removeEventListener(r,s,i){t.each(n=>{try{n.document.removeEventListener(r,s,i)}catch{}})}};return t}var T="pointerdown.outside",D="focus.outside";function R(e){for(const t of e)if(O(t)&&M(t))return!0;return!1}var F=e=>"clientY"in e;function V(e,t){if(!F(t)||!e)return!1;const r=e.getBoundingClientRect();return r.width===0||r.height===0?!1:r.top<=t.clientY&&t.clientY<=r.top+r.height&&r.left<=t.clientX&&t.clientX<=r.left+r.width}function j(e){const t=g(e);if(!t||!F(e))return!1;const s=t.scrollHeight>t.clientHeight&&e.clientX>t.clientWidth,n=t.scrollWidth>t.clientWidth&&e.clientY>t.clientHeight;return s||n}function z(e,t){const{exclude:r,onFocusOutside:s,onPointerDownOutside:i,onInteractOutside:n,defer:b}=t;if(!e)return;const E=v(e),B=Y(e),m=U(B);function p(c){const u=g(c);return!O(u)||w(e,u)||V(e,c)||j(c)?!1:!(r!=null&&r(u))}const y=new Set;function a(c){function u(){var x;const h=b?P:L=>L(),W=((x=c.composedPath)==null?void 0:x.call(c))??[c.target];h(()=>{if(!(!e||!p(c))){if(i||n){const L=S(i,n);e.addEventListener(T,L,{once:!0})}I(e,T,{bubbles:!1,cancelable:!0,detail:{originalEvent:c,contextmenu:X(c),focusable:R(W)}})}})}c.pointerType==="touch"?(y.forEach(h=>h()),y.add(N(E,"pointerup",u)),y.add(m.queueBeforeEvent("pointerup",u))):u()}const o=new Set,f=setTimeout(()=>{o.add(m.addEventListener("pointerdown",a,!0)),o.add(k(E,"pointerdown",a,!0))},0);function l(c){(b?P:h=>h())(()=>{if(!(!e||!p(c))){if(s||n){const h=S(s,n);e.addEventListener(D,h,{once:!0})}I(e,D,{bubbles:!1,cancelable:!0,detail:{originalEvent:c,contextmenu:!1,focusable:M(g(c))}})}})}return o.add(k(E,"focusin",l,!0)),o.add(m.addEventListener("focusin",l,!0)),()=>{clearTimeout(f),y.forEach(c=>c()),o.forEach(c=>c())}}function $(e,t){const{defer:r}=t,s=r?P:n=>n(),i=[];return i.push(s(()=>{const n=typeof e=="function"?e():e;i.push(z(n,t))})),()=>{i.forEach(n=>n==null?void 0:n())}}function G(e,t){const r=s=>{s.key==="Escape"&&(s.isComposing||t==null||t(s))};return k(v(e),"keydown",r,{capture:!0})}var d={layers:[],branches:[],count(){return this.layers.length},pointerBlockingLayers(){return this.layers.filter(e=>e.pointerBlocking)},topMostPointerBlockingLayer(){return[...this.pointerBlockingLayers()].slice(-1)[0]},hasPointerBlockingLayer(){return this.pointerBlockingLayers().length>0},isBelowPointerBlockingLayer(e){var s;const t=this.indexOf(e),r=this.topMostPointerBlockingLayer()?this.indexOf((s=this.topMostPointerBlockingLayer())==null?void 0:s.node):-1;return t<r},isTopMost(e){const t=this.layers[this.count()-1];return(t==null?void 0:t.node)===e},getNestedLayers(e){return Array.from(this.layers).slice(this.indexOf(e)+1)},isInNestedLayer(e,t){return this.getNestedLayers(e).some(r=>w(r.node,t))},isInBranch(e){return Array.from(this.branches).some(t=>w(t,e))},add(e){const t=this.layers.push(e);e.node.style.setProperty("--layer-index",`${t}`)},addBranch(e){this.branches.push(e)},remove(e){const t=this.indexOf(e);t<0||(t<this.count()-1&&this.getNestedLayers(e).forEach(s=>s.dismiss()),this.layers.splice(t,1),e.style.removeProperty("--layer-index"))},removeBranch(e){const t=this.branches.indexOf(e);t>=0&&this.branches.splice(t,1)},indexOf(e){return this.layers.findIndex(t=>t.node===e)},dismiss(e){var t;(t=this.layers[this.indexOf(e)])==null||t.dismiss()},clear(){this.remove(this.layers[0].node)}},A;function C(){d.layers.forEach(({node:e})=>{e.style.pointerEvents=d.isBelowPointerBlockingLayer(e)?"none":"auto"})}function J(e){e.style.pointerEvents=""}function Q(e,t){const r=v(e),s=[];if(d.hasPointerBlockingLayer()&&!r.body.hasAttribute("data-inert")&&(A=document.body.style.pointerEvents,queueMicrotask(()=>{r.body.style.pointerEvents="none",r.body.setAttribute("data-inert","")})),t){const i=_(t,n=>{s.push(q(n,{pointerEvents:"auto"}))});s.push(i)}return()=>{d.hasPointerBlockingLayer()||(queueMicrotask(()=>{r.body.style.pointerEvents=A,r.body.removeAttribute("data-inert"),r.body.style.length===0&&r.body.removeAttribute("style")}),s.forEach(i=>i()))}}function Z(e,t){if(!e){K("[@zag-js/dismissable] node is `null` or `undefined`");return}const{onDismiss:r,pointerBlocking:s,exclude:i,debug:n}=t,b={dismiss:r,node:e,pointerBlocking:s};d.add(b),C();function E(a){var f,l;const o=g(a.detail.originalEvent);d.isBelowPointerBlockingLayer(e)||d.isInBranch(o)||((f=t.onPointerDownOutside)==null||f.call(t,a),(l=t.onInteractOutside)==null||l.call(t,a),!a.defaultPrevented&&(n&&console.log("onPointerDownOutside:",a.detail.originalEvent),r==null||r()))}function B(a){var f,l;const o=g(a.detail.originalEvent);d.isInBranch(o)||((f=t.onFocusOutside)==null||f.call(t,a),(l=t.onInteractOutside)==null||l.call(t,a),!a.defaultPrevented&&(n&&console.log("onFocusOutside:",a.detail.originalEvent),r==null||r()))}function m(a){var o;d.isTopMost(e)&&((o=t.onEscapeKeyDown)==null||o.call(t,a),!a.defaultPrevented&&r&&(a.preventDefault(),r()))}function p(a){var c;if(!e)return!1;const o=typeof i=="function"?i():i,f=Array.isArray(o)?o:[o],l=(c=t.persistentElements)==null?void 0:c.map(u=>u()).filter(O);return l&&f.push(...l),f.some(u=>w(u,a))||d.isInNestedLayer(e,a)}const y=[s?Q(e,t.persistentElements):void 0,G(e,m),$(e,{exclude:p,onFocusOutside:B,onPointerDownOutside:E,defer:t.defer})];return()=>{d.remove(e),C(),J(e),y.forEach(a=>a==null?void 0:a())}}function ne(e,t){const{defer:r}=t,s=r?P:n=>n(),i=[];return i.push(s(()=>{const n=H(e)?e():e;i.push(Z(n,t))})),()=>{i.forEach(n=>n==null?void 0:n())}}export{ne as t};
