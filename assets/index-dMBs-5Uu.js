import{c as W,a as Y,y as H,z as X,B as S,D as z,F as K,d as w,g as q,r as b,G as D,f as P,H as B,p as A,h as L,I as R,J as V,K as j,L as G}from"./use-locale-context-BOqpzadf.js";import{r as J}from"./index-CDs2tPxN.js";import{u as $}from"./use-event-eGuf5zsd.js";import{a as k,f as T,i as Q}from"./index-4VAcYN_X.js";const[Ee,ye]=W({name:"PresenceContext",hookName:"usePresenceContext",providerName:"<PresenceProvider />"}),pe=t=>Y()(t,["lazyMount","onExitComplete","present","unmountOnExit"]);function Z(t,e,n){const i=t.matches("mounted","unmountSuspended");return{skip:!t.context.initial&&i,present:i,setNode(r){r&&e({type:"NODE.SET",node:r})},unmount(){e({type:"UNMOUNT"})}}}function N(t){return(t==null?void 0:t.animationName)||"none"}function ee(t){return H({initial:t.present?"mounted":"unmounted",context:{node:null,styles:null,unmountAnimationName:null,prevAnimationName:null,present:!1,initial:!1,...t},exit:["clearInitial"],watch:{present:["setInitial","syncPresence"]},on:{"NODE.SET":{actions:["setNode","setStyles"]}},states:{mounted:{on:{UNMOUNT:{target:"unmounted",actions:["invokeOnExitComplete"]},"UNMOUNT.SUSPEND":"unmountSuspended"}},unmountSuspended:{activities:["trackAnimationEvents"],on:{MOUNT:{target:"mounted",actions:["setPrevAnimationName"]},"ANIMATION.END":{target:"unmounted",actions:["invokeOnExitComplete"]},UNMOUNT:{target:"unmounted",actions:["invokeOnExitComplete"]}}},unmounted:{entry:["clearPrevAnimationName"],on:{MOUNT:{target:"mounted",actions:["setPrevAnimationName"]}}}}},{actions:{setInitial(e){e.initial=!0},clearInitial(e){e.initial=!1},invokeOnExitComplete(e){var n;(n=e.onExitComplete)==null||n.call(e)},setNode(e,n){e.node=S(n.node)},setStyles(e,n){const i=n.node.ownerDocument.defaultView||window;e.styles=S(i.getComputedStyle(n.node))},syncPresence(e,n,{send:i}){if(e.rafId&&cancelAnimationFrame(e.rafId),e.present){i({type:"MOUNT",src:"presence.changed"});return}e.rafId=requestAnimationFrame(()=>{var s;const r=N(e.styles);e.unmountAnimationName=r,r==="none"||r===e.prevAnimationName||((s=e.styles)==null?void 0:s.display)==="none"?i({type:"UNMOUNT",src:"presence.changed"}):i({type:"UNMOUNT.SUSPEND"})})},setPrevAnimationName(e){requestAnimationFrame(()=>{e.prevAnimationName=N(e.styles)})},clearPrevAnimationName(e){e.prevAnimationName=null}},activities:{trackAnimationEvents(e,n,{send:i}){const r=e.node;if(!r)return;const s=l=>{l.target===r&&(e.prevAnimationName=N(e.styles))},m=l=>{const d=N(e.styles);l.target===r&&d===e.unmountAnimationName&&i({type:"UNMOUNT",src:"animationend"})};return r.addEventListener("animationstart",s),r.addEventListener("animationcancel",m),r.addEventListener("animationend",m),()=>{r.removeEventListener("animationstart",s),r.removeEventListener("animationcancel",m),r.removeEventListener("animationend",m)}}}})}X()(["onExitComplete","present"]);const ge=t=>{const{lazyMount:e,unmountOnExit:n,...i}=t,r=J.useRef(!1),s={...i,onExitComplete:$(t.onExitComplete)},[m,l]=z(ee(s),{context:s}),d=Z(m,l);d.present&&(r.current=!0);const y=!d.present&&!r.current&&e||n&&!d.present&&r.current;return{getPresenceProps:p=>({ref:K(d.setNode,p),"data-state":t.present?"open":"closed",hidden:!d.present}),present:d.present,unmounted:y}};function te(t){const e={each(n){var i;for(let r=0;r<((i=t.frames)==null?void 0:i.length);r+=1){const s=t.frames[r];s&&n(s)}},addEventListener(n,i,r){return e.each(s=>{try{s.document.addEventListener(n,i,r)}catch{}}),()=>{try{e.removeEventListener(n,i,r)}catch{}}},removeEventListener(n,i,r){e.each(s=>{try{s.document.removeEventListener(n,i,r)}catch{}})}};return e}var M="pointerdown.outside",x="focus.outside";function ne(t){for(const e of t)if(A(e)&&D(e))return!0;return!1}var F=t=>"clientY"in t;function re(t,e){if(!F(e)||!t)return!1;const n=t.getBoundingClientRect();return n.width===0||n.height===0?!1:n.top<=e.clientY&&e.clientY<=n.top+n.height&&n.left<=e.clientX&&e.clientX<=n.left+n.width}function ie(t){const e=P(t);if(!e||!F(t))return!1;const i=e.scrollHeight>e.clientHeight&&t.clientX>e.clientWidth,s=e.scrollWidth>e.clientWidth&&t.clientY>e.clientHeight;return i||s}function se(t,e){const{exclude:n,onFocusOutside:i,onPointerDownOutside:r,onInteractOutside:s,defer:m}=e;if(!t)return;const l=w(t),d=q(t),y=te(d);function g(o){const u=P(o);return!A(u)||L(t,u)||re(t,o)||ie(o)?!1:!(n!=null&&n(u))}let p;function a(o){function u(){var I;const v=m?b:O=>O(),_=((I=o.composedPath)==null?void 0:I.call(o))??[o.target];v(()=>{if(!(!t||!g(o))){if(r||s){const O=B(r,s);t.addEventListener(M,O,{once:!0})}T(t,M,{bubbles:!1,cancelable:!0,detail:{originalEvent:o,contextmenu:Q(o),focusable:ne(_)}})}})}o.pointerType==="touch"?(y.removeEventListener("click",u),l.removeEventListener("click",u),p=u,l.addEventListener("click",u,{once:!0}),y.addEventListener("click",u,{once:!0})):u()}const c=new Set,E=setTimeout(()=>{c.add(y.addEventListener("pointerdown",a,!0)),c.add(k(l,"pointerdown",a,!0))},0);function f(o){(m?b:v=>v())(()=>{if(!(!t||!g(o))){if(i||s){const v=B(i,s);t.addEventListener(x,v,{once:!0})}T(t,x,{bubbles:!1,cancelable:!0,detail:{originalEvent:o,contextmenu:!1,focusable:D(P(o))}})}})}return c.add(k(l,"focusin",f,!0)),c.add(y.addEventListener("focusin",f,!0)),()=>{clearTimeout(E),p&&(y.removeEventListener("click",p),l.removeEventListener("click",p)),c.forEach(o=>o())}}function ae(t,e){const{defer:n}=e,i=n?b:s=>s(),r=[];return r.push(i(()=>{const s=typeof t=="function"?t():t;r.push(se(s,e))})),()=>{r.forEach(s=>s==null?void 0:s())}}function oe(t,e){const n=i=>{i.key==="Escape"&&(i.isComposing||e==null||e(i))};return k(w(t),"keydown",n,{capture:!0})}var h={layers:[],branches:[],count(){return this.layers.length},pointerBlockingLayers(){return this.layers.filter(t=>t.pointerBlocking)},topMostPointerBlockingLayer(){return[...this.pointerBlockingLayers()].slice(-1)[0]},hasPointerBlockingLayer(){return this.pointerBlockingLayers().length>0},isBelowPointerBlockingLayer(t){var i;const e=this.indexOf(t),n=this.topMostPointerBlockingLayer()?this.indexOf((i=this.topMostPointerBlockingLayer())==null?void 0:i.node):-1;return e<n},isTopMost(t){const e=this.layers[this.count()-1];return(e==null?void 0:e.node)===t},getNestedLayers(t){return Array.from(this.layers).slice(this.indexOf(t)+1)},isInNestedLayer(t,e){return this.getNestedLayers(t).some(n=>L(n.node,e))},isInBranch(t){return Array.from(this.branches).some(e=>L(e,t))},add(t){const e=this.layers.push(t);t.node.style.setProperty("--layer-index",`${e}`)},addBranch(t){this.branches.push(t)},remove(t){const e=this.indexOf(t);e<0||(e<this.count()-1&&this.getNestedLayers(t).forEach(i=>i.dismiss()),this.layers.splice(e,1),t.style.removeProperty("--layer-index"))},removeBranch(t){const e=this.branches.indexOf(t);e>=0&&this.branches.splice(e,1)},indexOf(t){return this.layers.findIndex(e=>e.node===t)},dismiss(t){var e;(e=this.layers[this.indexOf(t)])==null||e.dismiss()},clear(){this.remove(this.layers[0].node)}},C;function U(){h.layers.forEach(({node:t})=>{t.style.pointerEvents=h.isBelowPointerBlockingLayer(t)?"none":"auto"})}function ce(t){t.style.pointerEvents=""}function ue(t,e){const n=w(t),i=[];if(h.hasPointerBlockingLayer()&&!n.body.hasAttribute("data-inert")&&(C=document.body.style.pointerEvents,queueMicrotask(()=>{n.body.style.pointerEvents="none",n.body.setAttribute("data-inert","")})),e){const r=j(e,s=>{i.push(G(s,{pointerEvents:"auto"}))});i.push(r)}return()=>{h.hasPointerBlockingLayer()||(queueMicrotask(()=>{n.body.style.pointerEvents=C,n.body.removeAttribute("data-inert"),n.body.style.length===0&&n.body.removeAttribute("style")}),i.forEach(r=>r()))}}function le(t,e){if(!t){V("[@zag-js/dismissable] node is `null` or `undefined`");return}const{onDismiss:n,pointerBlocking:i,exclude:r,debug:s}=e,m={dismiss:n,node:t,pointerBlocking:i};h.add(m),U();function l(a){var E,f;const c=P(a.detail.originalEvent);h.isBelowPointerBlockingLayer(t)||h.isInBranch(c)||((E=e.onPointerDownOutside)==null||E.call(e,a),(f=e.onInteractOutside)==null||f.call(e,a),!a.defaultPrevented&&(s&&console.log("onPointerDownOutside:",a.detail.originalEvent),n==null||n()))}function d(a){var E,f;const c=P(a.detail.originalEvent);h.isInBranch(c)||((E=e.onFocusOutside)==null||E.call(e,a),(f=e.onInteractOutside)==null||f.call(e,a),!a.defaultPrevented&&(s&&console.log("onFocusOutside:",a.detail.originalEvent),n==null||n()))}function y(a){var c;h.isTopMost(t)&&((c=e.onEscapeKeyDown)==null||c.call(e,a),!a.defaultPrevented&&n&&(a.preventDefault(),n()))}function g(a){var o;if(!t)return!1;const c=typeof r=="function"?r():r,E=Array.isArray(c)?c:[c],f=(o=e.persistentElements)==null?void 0:o.map(u=>u()).filter(A);return f&&E.push(...f),E.some(u=>L(u,a))||h.isInNestedLayer(t,a)}const p=[i?ue(t,e.persistentElements):void 0,oe(t,y),ae(t,{exclude:g,onFocusOutside:d,onPointerDownOutside:l,defer:e.defer})];return()=>{h.remove(t),U(),ce(t),p.forEach(a=>a==null?void 0:a())}}function ve(t,e){const{defer:n}=e,i=n?b:s=>s(),r=[];return r.push(i(()=>{const s=R(t)?t():t;r.push(le(s,e))})),()=>{r.forEach(s=>s==null?void 0:s())}}export{Ee as P,ye as a,pe as s,ve as t,ge as u};
