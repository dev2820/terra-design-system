import{c as p,o as N,p as v,A as c,B as E,C as P}from"./factory-BCwUXDVF.js";import{r as f}from"./index-CDs2tPxN.js";import{u as A}from"./use-event-eGuf5zsd.js";const[S,T]=p({name:"PresenceContext",hookName:"usePresenceContext",providerName:"<PresenceProvider />"});function U(t,e,i){const o=t.matches("mounted","unmountSuspended");return{skip:!t.context.initial&&o,present:o,setNode(n){n&&e({type:"NODE.SET",node:n})},unmount(){e({type:"UNMOUNT"})}}}function u(t){return(t==null?void 0:t.animationName)||"none"}function y(t){return N({initial:t.present?"mounted":"unmounted",context:{node:null,styles:null,unmountAnimationName:null,prevAnimationName:null,present:!1,initial:!1,...t},exit:["clearInitial"],watch:{present:["setInitial","syncPresence"]},on:{"NODE.SET":{actions:["setNode","setStyles"]}},states:{mounted:{on:{UNMOUNT:{target:"unmounted",actions:["invokeOnExitComplete"]},"UNMOUNT.SUSPEND":"unmountSuspended"}},unmountSuspended:{activities:["trackAnimationEvents"],on:{MOUNT:{target:"mounted",actions:["setPrevAnimationName"]},"ANIMATION.END":{target:"unmounted",actions:["invokeOnExitComplete"]},UNMOUNT:{target:"unmounted",actions:["invokeOnExitComplete"]}}},unmounted:{entry:["clearPrevAnimationName"],on:{MOUNT:{target:"mounted",actions:["setPrevAnimationName"]}}}}},{actions:{setInitial(e){e.initial=!0},clearInitial(e){e.initial=!1},invokeOnExitComplete(e){var i;(i=e.onExitComplete)==null||i.call(e)},setNode(e,i){e.node=c(i.node)},setStyles(e,i){const o=i.node.ownerDocument.defaultView||window;e.styles=c(o.getComputedStyle(i.node))},syncPresence(e,i,{send:o}){if(e.present){o({type:"MOUNT",src:"presence.changed"});return}const n=u(e.styles);(e.immediate?queueMicrotask:requestAnimationFrame)(()=>{var a,s;e.unmountAnimationName=n,n==="none"||n===e.prevAnimationName||((a=e.styles)==null?void 0:a.display)==="none"||((s=e.styles)==null?void 0:s.animationDuration)==="0s"?o({type:"UNMOUNT",src:"presence.changed"}):o({type:"UNMOUNT.SUSPEND"})})},setPrevAnimationName(e){(e.immediate?queueMicrotask:requestAnimationFrame)(()=>{e.prevAnimationName=u(e.styles)})},clearPrevAnimationName(e){e.prevAnimationName=null}},activities:{trackAnimationEvents(e,i,{send:o}){const n=e.node;if(!n)return;const m=s=>{s.target===n&&(e.prevAnimationName=u(e.styles))},a=s=>{const r=u(e.styles);s.target===n&&r===e.unmountAnimationName&&o({type:"UNMOUNT",src:"animationend"})};return n.addEventListener("animationstart",m),n.addEventListener("animationcancel",a),n.addEventListener("animationend",a),()=>{n.removeEventListener("animationstart",m),n.removeEventListener("animationcancel",a),n.removeEventListener("animationend",a)}}}})}v()(["onExitComplete","present","immediate"]);const k=t=>{const{lazyMount:e,unmountOnExit:i,...o}=t,n=f.useRef(!1),m={...o,onExitComplete:A(t.onExitComplete)},[a,s]=E(y(m),{context:m}),r=U(a,s);r.present&&(n.current=!0);const d=!r.present&&!n.current&&e||i&&!r.present&&n.current;return{getPresenceProps:l=>({ref:P(r.setNode,l),"data-state":t.present?"open":"closed",hidden:!r.present}),present:r.present,unmounted:d}};export{S as P,T as a,k as u};
