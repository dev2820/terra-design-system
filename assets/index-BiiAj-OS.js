import{c as W,a as Y,t as X,u as z,w as S,x as H,z as K,d as L,g as R,r as b,A as D,f as P,o as A,h as O,B as V,C as j}from"./create-split-props-aocGlKWx.js";import{r as $}from"./index-CDs2tPxN.js";import{u as G}from"./use-event-eGuf5zsd.js";import{a as w,q,f as x,i as J}from"./index-CUeq2rMp.js";import{f as M,g as Q,w as Z}from"./use-locale-context-B_Gjrn4q.js";const[ye,ge]=W({name:"PresenceContext",hookName:"usePresenceContext",providerName:"<PresenceProvider />"}),ve=t=>Y()(t,["immediate","lazyMount","onExitComplete","present","unmountOnExit"]);function ee(t,e,n){const i=t.matches("mounted","unmountSuspended");return{skip:!t.context.initial&&i,present:i,setNode(r){r&&e({type:"NODE.SET",node:r})},unmount(){e({type:"UNMOUNT"})}}}function N(t){return(t==null?void 0:t.animationName)||"none"}function te(t){return X({initial:t.present?"mounted":"unmounted",context:{node:null,styles:null,unmountAnimationName:null,prevAnimationName:null,present:!1,initial:!1,...t},exit:["clearInitial"],watch:{present:["setInitial","syncPresence"]},on:{"NODE.SET":{actions:["setNode","setStyles"]}},states:{mounted:{on:{UNMOUNT:{target:"unmounted",actions:["invokeOnExitComplete"]},"UNMOUNT.SUSPEND":"unmountSuspended"}},unmountSuspended:{activities:["trackAnimationEvents"],on:{MOUNT:{target:"mounted",actions:["setPrevAnimationName"]},"ANIMATION.END":{target:"unmounted",actions:["invokeOnExitComplete"]},UNMOUNT:{target:"unmounted",actions:["invokeOnExitComplete"]}}},unmounted:{entry:["clearPrevAnimationName"],on:{MOUNT:{target:"mounted",actions:["setPrevAnimationName"]}}}}},{actions:{setInitial(e){e.initial=!0},clearInitial(e){e.initial=!1},invokeOnExitComplete(e){var n;(n=e.onExitComplete)==null||n.call(e)},setNode(e,n){e.node=S(n.node)},setStyles(e,n){const i=n.node.ownerDocument.defaultView||window;e.styles=S(i.getComputedStyle(n.node))},syncPresence(e,n,{send:i}){if(e.present){i({type:"MOUNT",src:"presence.changed"});return}const r=N(e.styles);(e.immediate?queueMicrotask:requestAnimationFrame)(()=>{var u,l;e.unmountAnimationName=r,r==="none"||r===e.prevAnimationName||((u=e.styles)==null?void 0:u.display)==="none"||((l=e.styles)==null?void 0:l.animationDuration)==="0s"?i({type:"UNMOUNT",src:"presence.changed"}):i({type:"UNMOUNT.SUSPEND"})})},setPrevAnimationName(e){(e.immediate?queueMicrotask:requestAnimationFrame)(()=>{e.prevAnimationName=N(e.styles)})},clearPrevAnimationName(e){e.prevAnimationName=null}},activities:{trackAnimationEvents(e,n,{send:i}){const r=e.node;if(!r)return;const s=l=>{l.target===r&&(e.prevAnimationName=N(e.styles))},u=l=>{const d=N(e.styles);l.target===r&&d===e.unmountAnimationName&&i({type:"UNMOUNT",src:"animationend"})};return r.addEventListener("animationstart",s),r.addEventListener("animationcancel",u),r.addEventListener("animationend",u),()=>{r.removeEventListener("animationstart",s),r.removeEventListener("animationcancel",u),r.removeEventListener("animationend",u)}}}})}z()(["onExitComplete","present","immediate"]);const Pe=t=>{const{lazyMount:e,unmountOnExit:n,...i}=t,r=$.useRef(!1),s={...i,onExitComplete:G(t.onExitComplete)},[u,l]=H(te(s),{context:s}),d=ee(u,l);d.present&&(r.current=!0);const y=!d.present&&!r.current&&e||n&&!d.present&&r.current;return{getPresenceProps:p=>({ref:K(d.setNode,p),"data-state":t.present?"open":"closed",hidden:!d.present}),present:d.present,unmounted:y}};function ne(t){const e={each(n){var i;for(let r=0;r<((i=t.frames)==null?void 0:i.length);r+=1){const s=t.frames[r];s&&n(s)}},queueBeforeEvent(n,i){const r=new Set;return e.each(s=>{try{r.add(q(s.document,n,i))}catch{}}),()=>{try{r.forEach(s=>s())}catch{}}},addEventListener(n,i,r){return e.each(s=>{try{s.document.addEventListener(n,i,r)}catch{}}),()=>{try{e.removeEventListener(n,i,r)}catch{}}},removeEventListener(n,i,r){e.each(s=>{try{s.document.removeEventListener(n,i,r)}catch{}})}};return e}var T="pointerdown.outside",C="focus.outside";function re(t){for(const e of t)if(A(e)&&D(e))return!0;return!1}var _=t=>"clientY"in t;function ie(t,e){if(!_(e)||!t)return!1;const n=t.getBoundingClientRect();return n.width===0||n.height===0?!1:n.top<=e.clientY&&e.clientY<=n.top+n.height&&n.left<=e.clientX&&e.clientX<=n.left+n.width}function se(t){const e=P(t);if(!e||!_(t))return!1;const i=e.scrollHeight>e.clientHeight&&t.clientX>e.clientWidth,s=e.scrollWidth>e.clientWidth&&t.clientY>e.clientHeight;return i||s}function oe(t,e){const{exclude:n,onFocusOutside:i,onPointerDownOutside:r,onInteractOutside:s,defer:u}=e;if(!t)return;const l=L(t),d=R(t),y=ne(d);function v(a){const m=P(a);return!A(m)||O(t,m)||ie(t,a)||se(a)?!1:!(n!=null&&n(m))}const p=new Set;function o(a){function m(){var B;const g=u?b:k=>k(),F=((B=a.composedPath)==null?void 0:B.call(a))??[a.target];g(()=>{if(!(!t||!v(a))){if(r||s){const k=M(r,s);t.addEventListener(T,k,{once:!0})}x(t,T,{bubbles:!1,cancelable:!0,detail:{originalEvent:a,contextmenu:J(a),focusable:re(F)}})}})}a.pointerType==="touch"?(p.forEach(g=>g()),p.add(q(l,"pointerup",m)),p.add(y.queueBeforeEvent("pointerup",m))):m()}const c=new Set,E=setTimeout(()=>{c.add(y.addEventListener("pointerdown",o,!0)),c.add(w(l,"pointerdown",o,!0))},0);function f(a){(u?b:g=>g())(()=>{if(!(!t||!v(a))){if(i||s){const g=M(i,s);t.addEventListener(C,g,{once:!0})}x(t,C,{bubbles:!1,cancelable:!0,detail:{originalEvent:a,contextmenu:!1,focusable:D(P(a))}})}})}return c.add(w(l,"focusin",f,!0)),c.add(y.addEventListener("focusin",f,!0)),()=>{clearTimeout(E),p.forEach(a=>a()),c.forEach(a=>a())}}function ae(t,e){const{defer:n}=e,i=n?b:s=>s(),r=[];return r.push(i(()=>{const s=typeof t=="function"?t():t;r.push(oe(s,e))})),()=>{r.forEach(s=>s==null?void 0:s())}}function ce(t,e){const n=i=>{i.key==="Escape"&&(i.isComposing||e==null||e(i))};return w(L(t),"keydown",n,{capture:!0})}var h={layers:[],branches:[],count(){return this.layers.length},pointerBlockingLayers(){return this.layers.filter(t=>t.pointerBlocking)},topMostPointerBlockingLayer(){return[...this.pointerBlockingLayers()].slice(-1)[0]},hasPointerBlockingLayer(){return this.pointerBlockingLayers().length>0},isBelowPointerBlockingLayer(t){var i;const e=this.indexOf(t),n=this.topMostPointerBlockingLayer()?this.indexOf((i=this.topMostPointerBlockingLayer())==null?void 0:i.node):-1;return e<n},isTopMost(t){const e=this.layers[this.count()-1];return(e==null?void 0:e.node)===t},getNestedLayers(t){return Array.from(this.layers).slice(this.indexOf(t)+1)},isInNestedLayer(t,e){return this.getNestedLayers(t).some(n=>O(n.node,e))},isInBranch(t){return Array.from(this.branches).some(e=>O(e,t))},add(t){const e=this.layers.push(t);t.node.style.setProperty("--layer-index",`${e}`)},addBranch(t){this.branches.push(t)},remove(t){const e=this.indexOf(t);e<0||(e<this.count()-1&&this.getNestedLayers(t).forEach(i=>i.dismiss()),this.layers.splice(e,1),t.style.removeProperty("--layer-index"))},removeBranch(t){const e=this.branches.indexOf(t);e>=0&&this.branches.splice(e,1)},indexOf(t){return this.layers.findIndex(e=>e.node===t)},dismiss(t){var e;(e=this.layers[this.indexOf(t)])==null||e.dismiss()},clear(){this.remove(this.layers[0].node)}},I;function U(){h.layers.forEach(({node:t})=>{t.style.pointerEvents=h.isBelowPointerBlockingLayer(t)?"none":"auto"})}function ue(t){t.style.pointerEvents=""}function le(t,e){const n=L(t),i=[];if(h.hasPointerBlockingLayer()&&!n.body.hasAttribute("data-inert")&&(I=document.body.style.pointerEvents,queueMicrotask(()=>{n.body.style.pointerEvents="none",n.body.setAttribute("data-inert","")})),e){const r=V(e,s=>{i.push(j(s,{pointerEvents:"auto"}))});i.push(r)}return()=>{h.hasPointerBlockingLayer()||(queueMicrotask(()=>{n.body.style.pointerEvents=I,n.body.removeAttribute("data-inert"),n.body.style.length===0&&n.body.removeAttribute("style")}),i.forEach(r=>r()))}}function de(t,e){if(!t){Z("[@zag-js/dismissable] node is `null` or `undefined`");return}const{onDismiss:n,pointerBlocking:i,exclude:r,debug:s}=e,u={dismiss:n,node:t,pointerBlocking:i};h.add(u),U();function l(o){var E,f;const c=P(o.detail.originalEvent);h.isBelowPointerBlockingLayer(t)||h.isInBranch(c)||((E=e.onPointerDownOutside)==null||E.call(e,o),(f=e.onInteractOutside)==null||f.call(e,o),!o.defaultPrevented&&(s&&console.log("onPointerDownOutside:",o.detail.originalEvent),n==null||n()))}function d(o){var E,f;const c=P(o.detail.originalEvent);h.isInBranch(c)||((E=e.onFocusOutside)==null||E.call(e,o),(f=e.onInteractOutside)==null||f.call(e,o),!o.defaultPrevented&&(s&&console.log("onFocusOutside:",o.detail.originalEvent),n==null||n()))}function y(o){var c;h.isTopMost(t)&&((c=e.onEscapeKeyDown)==null||c.call(e,o),!o.defaultPrevented&&n&&(o.preventDefault(),n()))}function v(o){var a;if(!t)return!1;const c=typeof r=="function"?r():r,E=Array.isArray(c)?c:[c],f=(a=e.persistentElements)==null?void 0:a.map(m=>m()).filter(A);return f&&E.push(...f),E.some(m=>O(m,o))||h.isInNestedLayer(t,o)}const p=[i?le(t,e.persistentElements):void 0,ce(t,y),ae(t,{exclude:v,onFocusOutside:d,onPointerDownOutside:l,defer:e.defer})];return()=>{h.remove(t),U(),ue(t),p.forEach(o=>o==null?void 0:o())}}function Ne(t,e){const{defer:n}=e,i=n?b:s=>s(),r=[];return r.push(i(()=>{const s=Q(t)?t():t;r.push(de(s,e))})),()=>{r.forEach(s=>s==null?void 0:s())}}export{ye as P,ge as a,ve as s,Ne as t,Pe as u};
